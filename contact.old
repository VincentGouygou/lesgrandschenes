<?php 
    include "headerG.php";
     include "barnav.php";
     
     
 
  // enregistrer l'ip du client
    if (!empty($_SERVER['HTTP_CLIENT_IP'])) {
       
        $ip = $_SERVER['HTTP_CLIENT_IP'];
    } elseif (!empty($_SERVER['HTTP_X_FORWARDED_FOR'])) {
          
        $ip = $_SERVER['HTTP_X_FORWARDED_FOR'];
    } else {
        $ip = $_SERVER['REMOTE_ADDR'];
    }
  
    echo  "<input id='ip' value='$ip' size='40' hidden>";
 ?>   

                
        

 <div class=" hobo  " >
    <div class="flex  flexcolumn   ">
        <div   class="  flex  blurdiv    center  justselfcenter  fitcontent   paddinglittle              border shadow">
               Tél. : 06.61.05.67.58 <br>  
                    lesgrandschenespinsac@gmail.com <br> 
                    230 chemin de Piboulades, 46200 Pinsac
        </div>
        <div class="flex  flexcolumn  justselfcenter fitcontent    border shadow  paddinglittle     marginlittle  " >
                    
                     <b class="mediumBigFont center paddingVeryLittle"> Envoyer un message </b>   
                    <div class="flex  flexrow ">
                        
                        <div class="flex flexcolumn lineheightlittle   paddingVeryLittle  "> 
                         
                            <label  class="   right"> Nom  </label>  
                            <label class="   right"> Prénom</label>   
                            <label class="   right"> Adresse</label> 
                            <label class=" right "> Téléphone  </label>   
                            <label class="   right"> Email</label> 
                            <label class="  right"> Message </label> 
                            
                        </div>
                         <div class="flex   flexcolumn paddingVeryLittle  lineheightlittle ">
                             <input class="    " type="text"     name="fNom"       id="fNom" value="" required width="1em" minlength="3" title="Minimum of 3 characters." > 
                              <input class="   " type="text"     name="fPrenom"    id="fPrenom" value="" required minlength= "3" title="Minimum of 3 characters.">  
                               <input class="    " size="25" type="text"     name="fAdresse"    id="fAdresse" value="" required  minlength="5" title="Adresse d'au moins 3 caractères ">
                                  <input class="    "  size="25" type="text"     name="fTel"       id="fTel" value="" required minlength="10" title="Téléphone au moins 10 chiffres"> 
                              <input class="     " type="email"    name="fEmail"     id="fEmail" value="" required>  
                             <textarea rows="4" cols="25" maxlength="1000" class="    " type="text"     name="fMessage"    id="fMessage" value="" required></textarea>  
                             <button onclick="sendmsg()"  class="fitcontent" id="fbuttonsendmsg"   hidden   >Envoyer</button>
                             <b class=" littleFont " id="msgmail"></b>
                             <b class=" littleFont " id="nomprenomlength"></b>
                              <b class=" littleFont " id="msgadrtellengthlength"></b>
                         </div>
                          
                    </div>       
        </div>          
    </div>
       
</div>
 
 
 
 
 
<script  charset="utf-8" type="text/javascript">
 const myIntervalCheckmail = setInterval(checkmailprocedure,1000);
 //function pour verifier l'email
function checkmail() {
    const email = document.getElementById("fEmail");
    const isValidEmail = email.checkValidity();
    return isValidEmail;
}
//function pour verifier l'email

function checkmailprocedure() {
   
  
  
   
   
    let adressetelbool        =false;
    let nomprenomlengthbool =false;
    let mailbool        =false;
    
    let adresse =   $('#fAdresse').val();
    let tel =       $('#fTel').val();
    let nom =       $('#fNom').val();
    let prenom =    $('#fPrenom').val();
    let emailMsg =       $('#fEmail').val();
  
   
 
     if (adresse.length<3 || tel.length<10) { 
        adressetelbool=false;
       
        $('#msgadrtellengthlength').html("Adresse d'au moins 3 caractères <br> et Téléphone au moins 10");
    } else { 
        
        $('#msgadrtellengthlength').html("");
        adressetelbool=true;
    
    }
    if (nom.length<3 || prenom.length<3) { 
        nomprenomlengthbool=false;
       
        $('#nomprenomlength').html("Nom et prénom d'au moins 3 caractères");
       
    } else { 
        
        $('#nomprenomlength').html("");
       
        nomprenomlengthbool=true;
    
    }
    
 

    
    if  (checkmail()) {
        mailbool=true;
        $('#msgmail').html(" ");
        
    }
    if (!checkmail()) {
        mailbool=false;
        $('#msgmail').html("format d'email incorrect");
        
    }
    if (  mailbool && nomprenomlengthbool && adressetelbool) { 
        document.getElementById('fbuttonsendmsg').hidden=false;
    } else {
        document.getElementById('fbuttonsendmsg').hidden=true;
    }
      
}

    
    

function sendmsg(){
    clearInterval(myIntervalCheckmail);
  
     let nom =       $('#fNom').val();
    let prenom =    $('#fPrenom').val();
    let nomPrenom=nom+" "+prenom;
    let email =     $('#fEmail').val();
    let message =     $('#fMessage').val();
    let ip =     $('#ip').val();
        let myData =  { "nomPrenom": nomPrenom,
                    
                    "message": message,
                   
                    "email": email,
                    
                     "ip" : ip,
                    "action": "sendmsg"};
        // fonction Ajax de jQuery
        // j'appelle ajax sur le fichier ajaxmessage.php avec la méthode GET pour lui envoyer en json myData
    $.ajax({
        url: "server.php", // Url appelée
        method: "POST",              // la méthode GET ou POST
        data: myData,
        dataType: "JSON",
        // si l'envoi est réussi
        success: function(response) {
             if (response.action=="Error inserting:"){
                $('#msgmail').html(response.action+" "+response.error);

            
            }
             if (response.action=="msgOk"){
                $('#msgmail').html(response.action);
                document.getElementById('fbuttonsendmsg').hidden=true;
            
            }
        },
        // s il y a une erreur je l'affiche en console et dans la div #messageID
        error: function(error) {
            console.log("errrrror"+error.statusText);
            
        }
    });
}
    
 
    <?php 
    include "functions.js";
    ?>
 



</script>

<?php 
  
    include "footerG.php";
?>
